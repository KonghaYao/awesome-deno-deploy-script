<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body></body>
  <script type="module">
    import ClientOAuth2 from "https://esm.sh/client-oauth2";

    const Auth = new ClientOAuth2({
      clientId: "clientId1",
      clientSecret: "client@secret",
      accessTokenUri: location.origin + "/login/oauth/access_token",
      authorizationUri: location.origin + "/login/oauth/authorize",
      redirectUri: location.origin + "/auth/github/callback",
    });

    // login to server
    Auth.owner.getToken("mira", "12345").then(async (server) => {
      console.log(server);
      await server.expired();

      server = await server.refresh();
      console.log(server);
      const oAuthFetch = async (url, req = { url }) => {
        req.method = req.method ?? "get";
        const data = await server.sign(req);
        return fetch(data.url, data);
      };
      oAuthFetch(location.origin + "/api/users");
    });

    // Can also just pass the raw `data` object in place of an argument.
    // const token = githubAuth.createToken(
    //   "access token",
    //   "optional refresh token",
    //   "optional token type",
    //   { data: "raw user data" }
    // );

    // Set the token TTL.
    // token.expiresIn(1234); // Seconds.

    // Refresh the users credentials and save the new access token and info.
    // token.refresh().then((tokens) => {
    //   console.log(tokens);
    // });

    // Sign a standard HTTP request object, updating the URL with the access token
    // or adding authorization headers, depending on token type.
    // token.sign({
    //   method: "get",
    //   url: "https://api.github.com/users",
    // });
  </script>
</html>
